<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hệ Thống Quản Lý Sinh Viên PRO</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* --- CSS Variables & Global Reset --- */
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3f37c9;
            --success-color: #2ec4b6;
            --warning-color: #ff9f1c;
            --danger-color: #e71d36;
            --light-bg: #f8f9fa;
            --text-dark: #2b2d42;
            --shadow-sm: 0 2px 4px rgba(0,0,0,0.05);
            --shadow-md: 0 4px 8px rgba(0,0,0,0.1);
            --radius: 12px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Poppins', sans-serif; background: linear-gradient(135deg, #f6f8fd 0%, #e9ecf5 100%); color: var(--text-dark); padding: 30px 15px; min-height: 100vh; }

        /* --- Main Container --- */
        .container { max-width: 1000px; margin: 0 auto; background: #fff; padding: 30px; border-radius: var(--radius); box-shadow: var(--shadow-md); }
        h2 { text-align: center; color: var(--primary-color); margin-bottom: 25px; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; }
        h2 i { margin-right: 10px; }

        /* --- Form Styles --- */
        .form-section { background-color: #fcfdff; padding: 25px; border-radius: var(--radius); border: 1px solid #edf2f7; margin-bottom: 30px; }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 25px; }
        .input-control { display: flex; flex-direction: column; }
        label { margin-bottom: 8px; font-weight: 500; color: #555; font-size: 0.95rem; }
        input { padding: 12px 15px; border: 2px solid #e2e8f0; border-radius: 8px; transition: all 0.3s ease; font-family: inherit; }
        input:focus { border-color: var(--primary-color); outline: none; box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.15); }

        /* --- Buttons --- */
        .btn-group { text-align: center; display: flex; justify-content: center; gap: 15px; flex-wrap: wrap; }
        button { padding: 12px 25px; cursor: pointer; border: none; border-radius: 50px; font-weight: 500; color: white; transition: all 0.3s ease; display: flex; align-items: center; gap: 8px; font-family: inherit; font-size: 1rem; box-shadow: var(--shadow-sm); }
        button:hover { transform: translateY(-2px); box-shadow: var(--shadow-md); }
        button:active { transform: translateY(0); }
        .btn-add { background-color: var(--primary-color); }
        .btn-add:hover { background-color: var(--secondary-color); }
        .btn-update { background-color: var(--warning-color); color: #fff; display: none; }
        .btn-cancel { background-color: #95a5a6; display: none; }

        /* --- Search Bar --- */
        .search-container { margin-bottom: 20px; display: flex; gap: 10px; }
        .search-input-wrapper { position: relative; flex-grow: 1; }
        .search-input-wrapper i { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: #a0aec0; }
        #searchInput { width: 100%; padding: 12px 15px 12px 45px; border: 2px solid #e2e8f0; border-radius: 50px; }

        /* --- Table Styles --- */
        .table-responsive { overflow-x: auto; border-radius: var(--radius); box-shadow: var(--shadow-sm); }
        table { width: 100%; border-collapse: collapse; white-space: nowrap; background: white; }
        th, td { padding: 15px 20px; text-align: left; border-bottom: 1px solid #edf2f7; }
        th { background-color: var(--primary-color); color: white; font-weight: 500; text-transform: uppercase; font-size: 0.9rem; letter-spacing: 0.5px; }
        tr:hover td { background-color: #f7fafc; }
        
        .action-btn { padding: 8px 12px; font-size: 0.85rem; margin-right: 8px; border-radius: 6px; display: inline-flex; }
        .edit-btn { background-color: rgba(255, 159, 28, 0.15); color: var(--warning-color); }
        .edit-btn:hover { background-color: var(--warning-color); color: white; }
        .delete-btn { background-color: rgba(231, 29, 54, 0.15); color: var(--danger-color); }
        .delete-btn:hover { background-color: var(--danger-color); color: white; }

        /* --- Empty State --- */
        .empty-state { text-align: center; padding: 40px; color: #a0aec0; display: none; }
        .empty-state i { font-size: 4rem; margin-bottom: 20px; color: #cbd5e0; }

        /* --- Toast Notifications --- */
        #toast-container { position: fixed; top: 20px; right: 20px; z-index: 9999; }
        .toast { background: #fff; color: var(--text-dark); padding: 15px 25px; border-radius: 8px; margin-bottom: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.15); display: flex; align-items: center; animation: slideIn 0.3s ease forwards; border-left: 5px solid; max-width: 350px; }
        .toast i { margin-right: 15px; font-size: 1.2rem; }
        .toast.success { border-color: var(--success-color); } .toast.success i { color: var(--success-color); }
        .toast.error { border-color: var(--danger-color); } .toast.error i { color: var(--danger-color); }
        .toast.warning { border-color: var(--warning-color); } .toast.warning i { color: var(--warning-color); }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes slideOut { to { transform: translateX(100%); opacity: 0; } }
    </style>
</head>
<body>

<div id="toast-container"></div>

<div class="container">
    <h2><i class="fas fa-user-graduate"></i> Quản Lý Sinh Viên</h2>

    <div class="form-section" id="studentForm">
        <div class="form-grid">
            <div class="input-control">
                <label for="studentId"><i class="fas fa-id-card"></i> Mã SV</label>
                <input type="text" id="studentId" placeholder="VD: B21DCCN001">
            </div>
            <div class="input-control">
                <label for="fullName"><i class="fas fa-user"></i> Họ và Tên</label>
                <input type="text" id="fullName" placeholder="Nhập họ tên...">
            </div>
            <div class="input-control">
                <label for="dob"><i class="fas fa-calendar-alt"></i> Ngày sinh</label>
                <input type="date" id="dob">
            </div>
            <div class="input-control">
                <label for="className"><i class="fas fa-users"></i> Lớp</label>
                <input type="text" id="className" placeholder="VD: D21CQCN01">
            </div>
            <div class="input-control">
                <label for="gpa"><i class="fas fa-graduation-cap"></i> Điểm GPA</label>
                <input type="number" id="gpa" step="0.01" min="0" max="4" placeholder="Thang 4.0">
            </div>
        </div>
        <div class="btn-group">
            <button class="btn-add" onclick="manager.handleAdd()"><i class="fas fa-plus-circle"></i> Thêm mới</button>
            <button class="btn-update" onclick="manager.handleUpdate()"><i class="fas fa-save"></i> Cập nhật</button>
            <button class="btn-cancel" onclick="manager.resetForm()"><i class="fas fa-times"></i> Hủy</button>
        </div>
    </div>

    <div class="search-container">
        <div class="search-input-wrapper">
            <i class="fas fa-search"></i>
            <input type="text" id="searchInput" placeholder="Tìm kiếm theo tên hoặc mã SV..." onkeyup="manager.handleSearch()">
        </div>
    </div>

    <div class="table-responsive">
        <table id="studentTable">
            <thead>
                <tr>
                    <th>Mã SV</th>
                    <th>Họ và Tên</th>
                    <th>Ngày Sinh</th>
                    <th>Lớp</th>
                    <th>GPA</th>
                    <th>Hành động</th>
                </tr>
            </thead>
            <tbody>
                </tbody>
        </table>
        <div class="empty-state" id="emptyState">
            <i class="far fa-folder-open"></i>
            <p>Chưa có dữ liệu sinh viên nào.</p>
        </div>
    </div>
</div>

<script>
    // --- Hàm tiện ích: Hiển thị thông báo Toast ---
    function showToast(message, type = 'success') {
        const toastContainer = document.getElementById('toast-container');
        const toast = document.createElement('div');
        toast.className = `toast ${type}`;
        
        let iconClass = type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle';
        toast.innerHTML = `<i class="fas ${iconClass}"></i> <span>${message}</span>`;
        
        toastContainer.appendChild(toast);

        setTimeout(() => {
            toast.style.animation = 'slideOut 0.3s ease forwards';
            setTimeout(() => toast.remove(), 300);
        }, 3000);
    }

    /**
     * Lớp (Class) Sinh Viên
     */
    class Student {
        constructor(id, name, dob, className, gpa) {
            this.id = id;
            this.name = name;
            this.dob = dob;
            this.className = className;
            this.gpa = gpa;
        }

        updateInfo(name, dob, className, gpa) {
            this.name = name;
            this.dob = dob;
            this.className = className;
            this.gpa = gpa;
        }
    }

    /**
     * Lớp Quản Lý (Logic chính)
     */
    class StudentManager {
        constructor() {
            this.students = [];
            this.editingId = null;
            // Tải dữ liệu từ LocalStorage khi khởi động
            this.loadDataByLocalStorage();
        }

        // --- LocalStorage Functions ---
        saveDataToLocalStorage() {
            localStorage.setItem('students_data', JSON.stringify(this.students));
        }

        loadDataByLocalStorage() {
            const data = localStorage.getItem('students_data');
            if (data) {
                // Cần chuyển đổi từ plain object về instance của class Student
                this.students = JSON.parse(data).map(s => new Student(s.id, s.name, s.dob, s.className, s.gpa));
            } else {
                this.students = [];
            }
            this.renderTable();
        }

        getFormData() {
            return {
                id: document.getElementById('studentId').value.trim(),
                name: document.getElementById('fullName').value.trim(),
                dob: document.getElementById('dob').value,
                className: document.getElementById('className').value.trim(),
                gpa: document.getElementById('gpa').value
            };
        }

        handleAdd() {
            const data = this.getFormData();
            if (!data.id || !data.name || !data.dob || !data.className || !data.gpa) {
                showToast("Vui lòng điền đầy đủ thông tin!", "warning");
                return;
            }
            if (this.students.some(s => s.id === data.id)) {
                showToast("Mã sinh viên đã tồn tại!", "error");
                return;
            }

            const newStudent = new Student(data.id, data.name, data.dob, data.className, data.gpa);
            this.students.push(newStudent);
            
            this.saveDataToLocalStorage(); // Lưu ngay sau khi thêm
            this.renderTable();
            this.resetForm();
            showToast("Thêm sinh viên thành công!");
        }

        startEdit(id) {
            const student = this.students.find(s => s.id === id);
            if (!student) return;

            document.getElementById('studentId').value = student.id;
            document.getElementById('fullName').value = student.name;
            document.getElementById('dob').value = student.dob;
            document.getElementById('className').value = student.className;
            document.getElementById('gpa').value = student.gpa;

            document.getElementById('studentId').disabled = true;
            document.getElementById('fullName').focus();

            document.querySelector('.btn-add').style.display = 'none';
            document.querySelector('.btn-update').style.display = 'inline-flex';
            document.querySelector('.btn-cancel').style.display = 'inline-flex';
            
            this.editingId = id;
            showToast("Đang sửa thông tin. Hãy cập nhật!", "info");
        }

        handleUpdate() {
            const data = this.getFormData();
            const student = this.students.find(s => s.id === this.editingId);

            if (student) {
                student.updateInfo(data.name, data.dob, data.className, data.gpa);
                this.saveDataToLocalStorage(); // Lưu sau khi sửa
                this.renderTable();
                this.resetForm();
                showToast("Cập nhật thành công!");
            }
        }

        handleDelete(id) {
            // Sử dụng confirm mặc định trình duyệt cho đơn giản, có thể thay bằng custom modal nếu muốn
            if (confirm("Bạn có chắc chắn muốn xóa sinh viên này? Hành động này không thể hoàn tác.")) {
                this.students = this.students.filter(s => s.id !== id);
                this.saveDataToLocalStorage(); // Lưu sau khi xóa
                this.renderTable();
                showToast("Đã xóa sinh viên!", "error");
            }
        }

        handleSearch() {
            this.renderTable(); // renderTable giờ đã thông minh hơn để tự xử lý việc tìm kiếm
        }

        resetForm() {
            document.getElementById('studentId').value = '';
            document.getElementById('fullName').value = '';
            document.getElementById('dob').value = '';
            document.getElementById('className').value = '';
            document.getElementById('gpa').value = '';
            
            document.getElementById('studentId').disabled = false;
            this.editingId = null;

            document.querySelector('.btn-add').style.display = 'inline-flex';
            document.querySelector('.btn-update').style.display = 'none';
            document.querySelector('.btn-cancel').style.display = 'none';
        }

        // Render table có tích hợp chức năng tìm kiếm
        renderTable() {
            const tbody = document.querySelector('#studentTable tbody');
            const emptyState = document.getElementById('emptyState');
            const searchText = document.getElementById('searchInput').value.toLowerCase();

            tbody.innerHTML = '';

            // Lọc danh sách dựa trên từ khóa tìm kiếm
            let filteredStudents = this.students;
            if (searchText) {
                filteredStudents = this.students.filter(s => 
                    s.name.toLowerCase().includes(searchText) || 
                    s.id.toLowerCase().includes(searchText)
                );
            }

            // Kiểm tra nếu không có dữ liệu để hiển thị
            if (filteredStudents.length === 0) {
                emptyState.style.display = 'block';
                document.getElementById('studentTable').style.display = 'none';
                if(searchText) {
                     emptyState.querySelector('p').textContent = `Không tìm thấy kết quả cho "${searchText}"`;
                } else {
                     emptyState.querySelector('p').textContent = "Chưa có dữ liệu sinh viên nào.";
                }
            } else {
                emptyState.style.display = 'none';
                document.getElementById('studentTable').style.display = 'table';
                
                // Render các dòng dữ liệu
                filteredStudents.forEach(student => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td style="font-weight: 500; color: var(--primary-color)">${student.id}</td>
                        <td>${student.name}</td>
                        <td>${this.formatDate(student.dob)}</td>
                        <td><span style="background: #edf2f7; padding: 3px 8px; border-radius: 4px; font-size: 0.9em">${student.className}</span></td>
                        <td style="font-weight: bold">${this.formatGPA(student.gpa)}</td>
                        <td>
                            <button class="action-btn edit-btn" onclick="manager.startEdit('${student.id}')"><i class="fas fa-edit"></i> Sửa</button>
                            <button class="action-btn delete-btn" onclick="manager.handleDelete('${student.id}')"><i class="fas fa-trash-alt"></i> Xóa</button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            }
        }
        
        formatDate(dateString) {
            if(!dateString) return "";
            const date = new Date(dateString);
            return date.toLocaleDateString('vi-VN');
        }

        // Tô màu cho điểm GPA
        formatGPA(gpa) {
            let color = gpa >= 3.2 ? 'var(--success-color)' : gpa >= 2.5 ? 'var(--warning-color)' : 'var(--danger-color)';
            return `<span style="color: ${color}">${gpa}</span>`;
        }
    }

    const manager = new StudentManager();
</script>

</body>
</html>
